"use strict";Object.defineProperty(exports, "__esModule", { value: true });exports.getGitBranch = getGitBranch;exports.getGitEnv = getGitEnv;exports.getLocalGitInfo = getLocalGitInfo;var _nodeChild_process = await jitiImport("node:child_process");
var _pkgTypes = await jitiImport("pkg-types");
var _gitUrlParse = _interopRequireDefault(await jitiImport("git-url-parse"));function _interopRequireDefault(e) {return e && e.__esModule ? e : { default: e };}










function getGitBranch() {
  const envName =
  process.env.CF_PAGES_BRANCH ||
  process.env.CI_COMMIT_BRANCH ||
  process.env.VERCEL_GIT_COMMIT_REF ||
  process.env.BRANCH ||
  process.env.GITHUB_REF_NAME;

  if (envName && envName !== 'HEAD') {
    return envName;
  }
  try {
    const branch = (0, _nodeChild_process.execSync)('git rev-parse --abbrev-ref HEAD', { stdio: ['ignore', 'pipe', 'ignore'] }).toString().trim();
    if (branch && branch !== 'HEAD') {
      return branch;
    }
  }
  catch {

    // Ignore error
  }
  return 'main';
}

async function getLocalGitInfo(rootDir) {
  const remote = await getLocalGitRemote(rootDir);
  if (!remote) {
    return;
  }

  // https://www.npmjs.com/package/git-url-parse#clipboard-example
  const { name, owner, source } = (0, _gitUrlParse.default)(remote);
  const url = `https://${source}/${owner}/${name}`;

  return {
    name,
    owner,
    url
  };
}

async function getLocalGitRemote(dir) {
  try {
    const parsed = await (0, _pkgTypes.readGitConfig)(dir);
    if (!parsed) {
      return;
    }
    return parsed.remote?.['origin']?.url;
  }
  catch {

    // Ignore error
  }}

function getGitEnv() {
  // https://github.com/unjs/std-env/issues/59
  const envInfo = {
    // Provider
    provider: process.env.VERCEL_GIT_PROVIDER // vercel
    || (process.env.GITHUB_SERVER_URL ? 'github' : undefined) // github
    || '',
    // Owner
    owner: process.env.VERCEL_GIT_REPO_OWNER // vercel
    || process.env.GITHUB_REPOSITORY_OWNER // github
    || process.env.CI_PROJECT_PATH?.split('/').shift() // gitlab
    || '',
    // Name
    name: process.env.VERCEL_GIT_REPO_SLUG ||
    process.env.GITHUB_REPOSITORY?.split('/').pop() // github
    || process.env.CI_PROJECT_PATH?.split('/').splice(1).join('/') // gitlab
    || '',
    // Url
    url: process.env.REPOSITORY_URL || '' // netlify
  };

  if (!envInfo.url && envInfo.provider && envInfo.owner && envInfo.name) {
    envInfo.url = `https://${envInfo.provider}.com/${envInfo.owner}/${envInfo.name}`;
  }

  // If only url available (ex: Netlify)
  if (!envInfo.name && !envInfo.owner && envInfo.url) {
    try {
      const { name, owner } = (0, _gitUrlParse.default)(envInfo.url);
      envInfo.name = name;
      envInfo.owner = owner;
    }
    catch {

      // Ignore error
    }}

  return {
    name: envInfo.name,
    owner: envInfo.owner,
    url: envInfo.url
  };
} /* v9-978031c86ca70ec1 */
